# 类型转换：V8是怎么实现1+“2”的？

## 什么是类型系统 (Type System)？

对机器语言来说，所有的数据都是一堆二进制代码，CPU 处理这些数据的时候，并没有类型的概念，CPU 所做的仅仅是移动数据，比如对其进行移位，相加或相乘。

而在高级语言中，会为操作的数据赋予指定的类型，类型可以确认一个值或者一组值具有特定的意义和目的。所以，类型是`高级语言`中的概念。

每种语言都定义了自己的类型，还定义了如何操作这些类型，另外还定义了这些类型应该如何相互作用，我们就把这称为`类型系统`。

## V8 是怎么执行加法操作的？

> V8 会严格根据 [ECMAScript 规范](https://www.ecma-international.org/ecma-262/6.0/index.html#sec-addition-operator-plus-runtime-semantics-evaluation)
来执行操作。

通俗地理解，V8 会提供了一个 ToPrimitive 方法，其作用是将 a 和 b 转换为原生数据类型，其转换流程如下：

- 先检测该对象中是否存在 `valueOf` 方法，如果有并返回了`原始类型`，那么就使用该值进行强制类型转换；
- 如果 valueOf 没有返回原始类型，那么就使用 `toString` 方法的返回值；
- 如果 valueOf 和 toString 两个方法都不返回基本类型值，便会触发一个 `TypeError` 的错误。

在执行加法操作的时候，V8 会通过 ToPrimitive 方法将对象类型转换为原生类型

最后就是两个原生类型相加，如果其中一个值的类型是`字符串`时，则另一个值也需要强制转换为字符串，然后做字符串的连接运算。

在其他情况时，所有的值都会转换为`数字类型值`，然后做数字的相加。